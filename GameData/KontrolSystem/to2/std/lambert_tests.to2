use { vec3, Vec3 } from ksp::math
use * from ksp::testing
use { solve_lambert } from std::lambert

test sync fn test_lambert() -> Unit = {
    let r1 = vec3(648504.023102542,0.66820020588641,-263336.566579579)
    let r2 = vec3(-46751083.6470467,4495973.54963698,-1767031.31488983)
    let dt = 58553.7382595054
    let mu = 3531600000000.0

    let (v1, v2, _) = solve_lambert(r1, r2, dt, mu, true)
 
    assert_vec3(vec3(-1128.28693893474,732.710004902985,-2923.62674986443), v1, 1e-5)
    assert_vec3(vec3(-642.892754257143,51.6621752932847,22.6110542601633), v2, 1e-5)
}

sync fn create_testset() -> (r1: Vec3, r2: Vec3, dt: float, mu: float, shortway: bool, expected_v1: Vec3, expected_v2: Vec3)[] =[
    (r1: vec3(648504.023102542,0.66820020588641,-263336.566579579),   r2: vec3(-46751083.6470467,4495973.54963698,-1767031.31488983), dt: 58553.7382595054, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1128.28693893474,732.710004902985,-2923.62674986443), expected_v2: vec3(-642.892754257143,51.6621752932847,22.6110542601633) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-46298009.1016623,4774694.51638226,6534267.02068541),  dt: 27970.8407848234, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1677.8707687721,889.301313156503,2972.19428153253), expected_v2: vec3(-1564.48553965589,148.310334040635,171.025545681162) ),
    (r1: vec3(88835.1538585199,-0.563137876141154,-694287.55866406),  r2: vec3(-45662187.7827237,4848336.97147021,10022885.5878112),  dt: 15555.5524077111, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-4253.38274455443,472.989032332616,-595.397507566659), expected_v2: vec3(-2856.11839790847,302.337873755569,692.750663392863) ),
    (r1: vec3(527942.324205418,0.300123116961838,-459553.914378887),  r2: vec3(-44838580.0473146,3850725.29876581,-13552625.3550374), dt: 102395.877937986, mu: 3531600000000.0, shortway: false, expected_v1: vec3(449.088248408965,-257.189907066872,3121.07863240072), expected_v2: vec3(-234.378787852199,23.1566186721727,-112.193063814592) ),
    (r1: vec3(694285.442508468,0.907581291611329,-88677.3996024172),  r2: vec3(-45365805.5226489,3977221.91676954,-11624344.9323376), dt: 96862.261225875,  mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-73.105950546529,706.728153201957,-3085.81015285284), expected_v2: vec3(-291.535113762875,14.74301406823,-27.3331156566455) ),
    (r1: vec3(83462.7728388584,0.810878495964743,694912.641854852),   r2: vec3(-40688359.6173382,3065307.84858101,-23325121.2096226), dt: 142600.153251071, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-2681.05484668145,232.922630236071,1646.84765024764), expected_v2: vec3(-70.7000593856451,4.84843592121011,-89.6973204823052) ),
    (r1: vec3(481129.750292077,0.184439018059692,-508359.651655802),  r2: vec3(-43846037.1134977,3637922.64326495,-16531501.6947463), dt: 115866.7475902,   mu: 3531600000000.0, shortway: false, expected_v1: vec3(561.189080706555,-213.819852592515,3101.59302910708), expected_v2: vec3(-168.895246777439,16.3595865351566,-104.220288179979) ),
    (r1: vec3(602485.984566073,1.21841502437299,356215.011901523),    r2: vec3(-44260358.9834996,3723668.04151633,-15367332.8514851), dt: 110928.183016368, mu: 3531600000000.0, shortway: false, expected_v1: vec3(997.740173891856,-1157.31026287883,-2767.03100151627), expected_v2: vec3(-219.015389741972,34.1796829254592,-30.3471322741073) ),
    (r1: vec3(542658.414095653,0.338610522010317,-442079.04015081),   r2: vec3(-46343242.7513321,4766557.24770933,6211584.60422247),  dt: 29450.0355324545, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-2538.01780725903,659.930251071979,-2299.38864626565), expected_v2: vec3(-1463.48062368405,142.796365078556,247.292163917794) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-44836063.6906304,4892096.46640608,13220997.8781144),  dt: 2975.16476206355, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-15247.2409828429,1844.79789612993,5405.19225875146), expected_v2: vec3(-15277.9943279929,1639.07240549372,4364.9611556668) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-46446388.8921853,4310977.22766213,-5757467.69148252), dt: 72976.2018686603, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-845.216992414229,1897.3589558423,2418.49561832627), expected_v2: vec3(-461.433182660673,15.1079567796738,-95.6540742447355) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-45918510.6191232,4128031.08939953,-9135083.02350986), dt: 85468.1633463745, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-119.773946190832,-2708.63877175345,-1650.59295634964), expected_v2: vec3(-356.294944026986,72.0588420062696,-46.9365966991489) ),
    (r1: vec3(191578.743320981,-0.394821485706054,-673218.096269527), r2: vec3(-43020700.2388827,3476683.78912528,-18604623.6400157), dt: 122220.8874567,   mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1468.07099741335,162.786342608188,-2790.74400120836), expected_v2: vec3(-166.453252621406,12.7268849338821,-36.5828756665862) ),
    (r1: vec3(699557.384053326,1.02582136475566,22600.4141302019),    r2: vec3(-32004454.4920808,1787599.46750451,-34373236.4028776), dt: 194713.341357712, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1291.67790701484,156.252229331312,-2872.3101611872), expected_v2: vec3(-30.9837568361773,-1.68475074506963,30.4184606562493) ),
    (r1: vec3(103630.136564442,-0.539875295512093,-692233.676877407), r2: vec3(-31703851.5591545,1747374.9389154,-34652741.2644072),  dt: 194713.341357712, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-934.856084826129,65.6249045496922,-3010.472966329), expected_v2: vec3(-11.1975057988187,0.402664889866405,18.0132788363557) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-31599332.9077802,1733433.70930705,-34748775.0483195), dt: 194713.341357712, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1609.99335588333,-201.487012785632,2703.80026497032), expected_v2: vec3(33.5540982600653,2.48613363839614,-29.9022749012834) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-31599332.9077802,1733433.70930705,-34748775.0483195), dt: 194713.341357712, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1610.89694381357,201.467038399547,-2703.26350559445), expected_v2: vec3(-32.8134747476248,-2.52633279193133,30.7100920076304) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-33925746.7286883,2049510.97102411,-32462951.4012596), dt: 182757.102439975, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1499.88771674541,269.375423274175,-2760.68714297145), expected_v2: vec3(-45.241340378614,-2.65489936977001,19.5105094101746) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-37506134.8151922,2564618.16825851,-28208377.9199667), dt: 162372.690707146, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1297.8634141581,433.999553306006,-2841.47717883731), expected_v2: vec3(-74.8582442228149,-2.73343930574592,1.04312697085237) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-31599332.9077802,1733433.70930705,-34748775.0483195), dt: 194713.341357712, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1609.99335588333,-201.487012785632,2703.80026497032), expected_v2: vec3(33.5540982600653,2.48613363839614,-29.9022749012834) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-31599332.9077802,1733433.70930705,-34748775.0483195), dt: 194713.341357712, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1609.99335588333,-201.487012785632,2703.80026497032), expected_v2: vec3(33.5540982600653,2.48613363839614,-29.9022749012834) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-31599332.9077802,1733433.70930705,-34748775.0483195), dt: 194713.341357712, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1609.99335588333,-201.487012785632,2703.80026497032), expected_v2: vec3(33.5540982600653,2.48613363839614,-29.9022749012834) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-33238084.0081766,1954767.29490029,-33172408.0568201), dt: 186378.116149814, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1534.03788284956,247.120436403613,-2743.91450057128), expected_v2: vec3(-41.1274514960118,-2.62637156232968,22.8880300795601) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-32943442.5020117,1914523.86510648,-33467360.1362071), dt: 187906.091665152, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1548.30719509336,238.199589199097,-2736.66737829687), expected_v2: vec3(-39.4850874065897,-2.61179308670187,24.3179965794033) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-34132408.2792195,2078216.91107833,-32243754.7368661), dt: 181653.113478222, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1489.38023100973,276.493240486304,-2765.68252539997), expected_v2: vec3(-46.559166570623,-2.66204675740281,18.4845299640763) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-31601658.2754193,1733743.63047714,-34746644.8346801), dt: 194701.781409304, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1610.79198176488,201.525573864263,-2703.32169125335), expected_v2: vec3(-32.823938216262,-2.52650797639712,30.699219183514) ),
    (r1: vec3(613252.581675944,0.543991409328018,-337384.482110632),  r2: vec3(-31646346.118767,1739701.74359297,-34705651.055333),   dt: 194713.341357712, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(496.28339149359,94.7838577082831,-3112.40483303188), expected_v2: vec3(-25.4835872112206,-0.435827071813679,27.0750846069848) ),
    (r1: vec3(177458.808521977,-0.41891149391334,-677077.314100262),  r2: vec3(-37475972.5213705,2560098.71072216,-28248847.3777045), dt: 163044.281747769, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1081.00290417736,105.924544646124,-2960.48363946871), expected_v2: vec3(-57.9799741497722,3.45922087420195,-10.1553334819858) ),
    (r1: vec3(323201.004068766,-0.1539619879943,-620856.406259257),   r2: vec3(-35097054.4827933,2213723.98940212,-31181664.3675507), dt: 176812.492351303, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-607.99445765809,95.6511705734054,-3092.49519847769), expected_v2: vec3(-38.6531909333999,1.55719720871049,4.89226185339933) ),
    (r1: vec3(193949.826921713,0.947050486954952,672497.523439793),   r2: vec3(-41419051.3912164,3188829.87852858,-21983938.3609391), dt: 137060.214389554, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-2515.17908173573,278.077098830853,1885.4175411414), expected_v2: vec3(-87.4283850029159,5.42887515733335,-96.0704845355001) ),
    (r1: vec3(319460.563221635,-0.161249311814688,-622789.395611979), r2: vec3(-40859682.7314299,3093911.62184101,-23019861.8145965), dt: 142112.856802874, mu: 3531600000000.0, shortway: false, expected_v1: vec3(855.731677316669,-141.668932803489,3033.25436716914), expected_v2: vec3(-76.0496916983925,6.86614543498514,-79.6041216954953) ),
    (r1: vec3(49288.4840070939,-0.623759784904652,-698210.637499725), r2: vec3(-44325923.9950605,3737600.84684645,-15173753.7179754), dt: 110814.738726446, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1866.31629217839,168.44443414764,-2544.7158865753), expected_v2: vec3(-210.791864941947,17.5868786477348,-39.9314127814466) ),
    (r1: vec3(440736.915503962,1.172914024539,543712.532047385),      r2: vec3(-41570932.0489089,3215036.53797666,-21691499.4558807), dt: 135979.031500467, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1865.69380838329,-520.755985031455,-2491.48544018104), expected_v2: vec3(-132.63896795676,15.7792397447374,-18.3937994907929) ),
    (r1: vec3(271356.824106678,-0.25253647908405,-645204.273328265),  r2: vec3(-33948973.0491124,2052731.68809825,-32438457.4467917), dt: 185033.769707684, mu: 3531600000000.0, shortway: false, expected_v1: vec3(655.913406690193,-84.2150331216744,3082.9099016802), expected_v2: vec3(10.2503256180238,0.0533444730658398,-27.3134041533254) ),
    (r1: vec3(348767.803711931,-0.103373867191638,-606862.222119054), r2: vec3(-39330089.5711068,2845181.4489106,-25574381.6514005),  dt: 152999.634053028, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-809.361286265502,134.790750907761,-3045.4137335403), expected_v2: vec3(-82.1114764777371,4.74475042300011,-13.8987018702852) ),
    (r1: vec3(699878.479168238,1.01163674161213,7875.99332263238),    r2: vec3(-32005759.0802289,1787774.45858832,-34372012.5710375), dt: 194713.341357712, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1261.05820988019,152.453785204212,-2886.0838344256), expected_v2: vec3(-30.8081632468259,-1.61282849443616,30.3352116719388) ),
    (r1: vec3(612554.248883899,1.21534476468015,338609.533579153),    r2: vec3(-44327685.6157475,3737976.69690682,-15168514.0394447), dt: 110169.671507437, mu: 3531600000000.0, shortway: false, expected_v1: vec3(917.93729611261,-1297.39684007874,-2732.57538941096), expected_v2: vec3(-221.927604332866,36.6427268494398,-31.1687600649677) ),
    (r1: vec3(269993.170926387,-0.255061077665753,-645776.126036154), r2: vec3(-45881185.854562,4116973.72373671,-9325626.62437226),  dt: 86620.8388536821, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1250.16021226954,-203.968906909124,2908.76773444153), expected_v2: vec3(-336.205350127833,31.3683802746014,-103.048701101796) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-45290791.6159158,3958413.65961309,-11919528.3506975), dt: 95900.9167241395, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-502.375999330963,-3117.33484610727,246.020817682584), expected_v2: vec3(-279.588991723805,71.1425201160643,-79.1699137256663) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-46548802.4331654,4718706.33973607,4465736.50336286),  dt: 35575.6126583686, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1371.58942626189,953.273161949317,2932.02217977005), expected_v2: vec3(-1195.64386858963,107.307058476783,66.9102365916964) ),
    (r1: vec3(267330.156469907,-0.259981554461266,-646883.124366477), r2: vec3(-32801201.5846339,1895168.81752288,-33607878.685768),  dt: 189083.398743416, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-620.118771143515,77.0110047009235,-3090.47192143113), expected_v2: vec3(-21.4510898602067,0.611753012645266,15.4383089738867) ),
    (r1: vec3(697695.608216547,1.05614664918145,55774.5431044939),    r2: vec3(-41112325.6141503,3136482.55383567,-22559679.9575164), dt: 137866.963335642, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1012.74171625254,-492.901938145298,2947.76377182645), expected_v2: vec3(-83.9722490968525,14.7710433099712,-97.4771932563337) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-37061340.7012092,2498323.90373401,-28796100.484283),  dt: 165072.424916932, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1325.68050199207,407.291206509614,-2832.45903725859), expected_v2: vec3(-70.2478175056861,-2.72191644974271,3.41436471802794) ),
    (r1: vec3(428892.031989226,0.0649726622230834,-553144.97053404),  r2: vec3(-31671898.7114104,1743110.47919562,-34682162.5316455), dt: 194713.341357712, mu: 3531600000000.0, shortway: false, expected_v1: vec3(151.572281027288,-77.1736419125009,3148.470610375), expected_v2: vec3(24.9390257638471,-0.327492434239146,-17.973537454418) ),
    (r1: vec3(690047.790645728,0.873153968731106,-117180.294982349),  r2: vec3(-31625383.3770699,1736906.31713204,-34724894.2791603), dt: 194713.341357712, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1008.84829754926,-121.890518115755,2984.98624397414), expected_v2: vec3(31.4171099050104,0.934085915553509,-26.896439215073) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-36428735.771351,2405280.53642086,-29600031.0074534),  dt: 168819.815773528, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1363.71175640569,373.130737985548,-2818.94053939974), expected_v2: vec3(-64.2172281079804,-2.71045485241053,6.7507372223532) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-33452927.1413037,1984242.37899474,-32953974.6898614), dt: 185255.246177332, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1523.49876240405,253.849445085138,-2749.17739149682), expected_v2: vec3(-42.369452285332,-2.63609520641507,21.8388348150202) ),
    (r1: vec3(679135.577372613,1.14243481934594,169293.608600475),    r2: vec3(-31599535.8823849,1733460.76097947,-34748589.1196752), dt: 194713.341357712, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1605.56415901349,-200.422441366855,2706.51127377064), expected_v2: vec3(33.5417608842122,2.46740490515349,-29.8855965193857) ),
    (r1: vec3(623341.704630269,0.57738670646404,-318357.114821579),   r2: vec3(-33901726.343081,2046181.59539529,-32488245.4410439),  dt: 183109.19782213,  mu: 3531600000000.0, shortway: false, expected_v1: vec3(-452.159482246454,-118.634636881039,3118.36670093585), expected_v2: vec3(14.2101629612316,1.32362232347096,-39.4728147833041) ),
    (r1: vec3(466915.62345488,0.151036531371603,-521445.924653237),   r2: vec3(-36239821.3409093,2377762.66077457,-29833229.6928777), dt: 170258.294348626, mu: 3531600000000.0, shortway: false, expected_v1: vec3(231.449327112168,-115.03128639269,3142.73867643852), expected_v2: vec3(-9.27360429312964,2.09052823595584,-51.4556527822672) ),
    (r1: vec3(690440.406832083,1.10445116021726,114802.617443342),    r2: vec3(-33467611.4804225,1986261.07009516,-32938939.7029855), dt: 185204.015097204, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(1407.0678614332,221.116739347062,-2813.30039315148), expected_v2: vec3(-41.9398372123819,-2.07253844613112,21.5879634174751) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-34541836.639253,2135419.4741298,-31800967.0490799),   dt: 179443.184599486, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-1511.18691320069,-290.116377058392,2752.46053619463), expected_v2: vec3(12.2095602277755,4.94455454886927,-50.3347725769664) ),
    (r1: vec3(697845.973163594,0.947275646284529,-53902.5451829829),  r2: vec3(-44651359.9297279,3808477.91765637,-14168682.0973798), dt: 104550.690251625, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-613.520983178935,-645.863384735046,3035.03281848471), expected_v2: vec3(-222.061772028538,29.0345005895524,-117.157411339061) ),
    (r1: vec3(699919.947903195,1.00177758263944,-2096.32624939512),   r2: vec3(-44785662.6289001,3838663.21947535,-13729861.1638204), dt: 102849.832591609, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(221.181218474699,841.998639662606,-3041.63475758561), expected_v2: vec3(-259.245396090118,9.06147906573009,-31.9514335303782) ),
    (r1: vec3(678583.741802714,1.14382982389337,171491.919388464),    r2: vec3(-46705771.8991244,4654821.9740513,2429712.67783773),   dt: 43029.443088621,  mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1190.94628046861,1043.62417538838,2890.10187286982), expected_v2: vec3(-955.295640940439,80.0445689887928,3.33320951430154) ),
    (r1: vec3(64041.1063754228,0.785070096296786,696970.91526532),    r2: vec3(-41327496.5045973,3173125.49522691,-22157827.2232192), dt: 137720.477890274, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-2687.32152890202,229.182986884287,1638.06362274841), expected_v2: vec3(-85.497326981417,6.20929231006467,-93.6984738767259) ),
    (r1: vec3(1288272.95623323,432279.341870256,-1467521.41499764),   r2: vec3(-11062969.9341534,0.0,4648730.60480155),               dt: 13570.4509806091, mu: 3531600000000.0, shortway: false, expected_v1: vec3(519.275762319652,-838.367115506725,1578.04200270588), expected_v2: vec3(-709.786189042197,117.91750993194,45.6123125607241) ),
    (r1: vec3(-245137.800752945,838912.816643432,1798876.55931006),   r2: vec3(-11675015.7364651,0.0,-2773807.41099516),              dt: 24103.9335546317, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1518.46422285246,473.850565522382,688.208035694), expected_v2: vec3(-21.9705788374183,-99.160501260126,-224.733405584875) ),
    (r1: vec3(1150155.91582764,1530617.61495005,578170.681259743),    r2: vec3(-10683433.8768746,0.0,-5464818.44148998),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: false, expected_v1: vec3(740.914892115432,-1521.70153266934,389.095691438575), expected_v2: vec3(2.9945075851948,269.974189779711,-0.260309855291025) ),
    (r1: vec3(-366975.904304029,730003.0253299,1825444.34952721),     r2: vec3(-10753480.4311527,0.0,-5325660.39255386),              dt: 28991.2714891106, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1574.39119659249,-480.115644046449,-540.390975006096), expected_v2: vec3(-113.340724284395,90.4934425789918,192.685415118915) ),
    (r1: vec3(-971326.238985369,62424.0943752913,1747130.68799387),   r2: vec3(-10038250.0705312,0.0,-6575221.32870682),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1701.42117287768,37.533714702738,318.586178027854), expected_v2: vec3(182.886469253312,-6.94864079300464,-145.506936628552) ),
    (r1: vec3(735549.747920468,1456081.75005057,1157008.98029161),    r2: vec3(-10546427.857215,0.0,-5724758.46237716),               dt: 30960.7290321349, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1048.79168829164,1375.90484449268,146.717937229311), expected_v2: vec3(86.0990047986492,-240.761415413108,-78.5558625580461) ),
    (r1: vec3(-125135.290152584,939235.915983869,1761250.58622842),   r2: vec3(-10306257.1216457,0.0,-6146630.30794337),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1498.11770644988,714.560504154389,503.244091174869), expected_v2: vec3(154.718367849913,-127.851382388155,-157.631472333776) ),
    (r1: vec3(-158556.026514215,911973.85636032,1772847.83739451),    r2: vec3(-10296905.9261329,0.0,-6162282.72220361),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1510.16547195516,687.607960808782,504.459134698144), expected_v2: vec3(156.471541493127,-123.163895274321,-158.599747359319) ),
    (r1: vec3(710066.109776306,1446597.36574683,1184498.62918874),    r2: vec3(-11531473.33018,0.0,-3320410.04024313),                dt: 26132.666250798,  mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1187.09321915502,1181.64153529869,458.722274356398), expected_v2: vec3(-11.5299291636242,-221.6793516883,-153.503153803758) ),
    (r1: vec3(944925.322952843,1515359.25733815,900390.438209926),    r2: vec3(-11074108.7417588,0.0,-4622133.22781827),              dt: 28959.9772361088, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-974.642720564756,1435.10732531231,72.4003322270351), expected_v2: vec3(30.453576018571,-255.822223540658,-72.7111704187339) ),
    (r1: vec3(1055216.33138713,1530200.93669642,738186.278412933),    r2: vec3(-11467444.2807339,0.0,-3535211.68648547),              dt: 26976.5231644278, mu: 3531600000000.0, shortway: false, expected_v1: vec3(883.906434250363,-1490.0225335512,-129.547773427699), expected_v2: vec3(-92.3021264853244,255.056880467594,40.3647892076146) ),
    (r1: vec3(-110338.88442734,951140.137006945,1755843.02317925),    r2: vec3(-11624650.7953621,0.0,-2977833.75726185),              dt: 24627.2719086286, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1486.48342551253,569.199112222084,686.893698729713), expected_v2: vec3(-10.8176064248781,-116.222781890356,-220.776825565245) ),
    (r1: vec3(1085268.95324121,1531736.8248793,689850.321175209),     r2: vec3(-11198343.0221171,0.0,-4312437.07884546),              dt: 19079.1121498647, mu: 3531600000000.0, shortway: false, expected_v1: vec3(644.316809664888,-1641.66924265571,-43.3092323532542), expected_v2: vec3(-318.920002693708,247.230901869114,-78.9257946205636) ),
    (r1: vec3(788116.986564854,1474209.71067719,1097934.38588507),    r2: vec3(-10159377.2500761,0.0,-6386474.29264667),              dt: 22978.4387981821, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1077.38707973565,1366.48340763528,-118.801835769983), expected_v2: vec3(-77.3727021604281,-262.343174676466,-155.856930131518) ),
    (r1: vec3(761598.219179302,1465311.97824113,1128143.97038357),    r2: vec3(-7236696.10120871,0.0,-9572368.02148511),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: false, expected_v1: vec3(540.407617651269,-1542.60823559911,587.720372789889), expected_v2: vec3(-9.98052691069559,271.769522016031,9.19114586860051) ),
    (r1: vec3(1480790.74206322,1289977.27305375,-378469.322851105),   r2: vec3(-7787938.59615821,0.0,-9129513.26317396),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: false, expected_v1: vec3(-3.69933950435413,-904.906420965378,1478.85620555329), expected_v2: vec3(148.826106605629,171.445238072604,-106.545084697449) ),
    (r1: vec3(1493116.42046002,1241032.93286289,-480075.180162997),   r2: vec3(-7823122.46462539,0.0,-9099382.11657658),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(55.9045320882586,873.957487497342,-1496.06959249879), expected_v2: vec3(-101.459003610928,-157.934496811895,164.097322926823) ),
    (r1: vec3(-410905.025780828,688925.268416296,1832037.56973105),   r2: vec3(-6699706.99015353,0.0,-9955597.73424418),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1588.84356820286,694.044941670477,99.8023874534904), expected_v2: vec3(217.87358074445,-120.812436758067,-104.594138370885) ),
    (r1: vec3(1161176.80326597,1529751.46915795,558086.909893364),    r2: vec3(-7463456.18105146,0.0,-9396638.85831124),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-136.104566303769,1409.5992962369,-1004.22375294879), expected_v2: vec3(-46.5121460279616,-247.204528330559,87.5017278576939) ),
    (r1: vec3(413074.297185933,1306777.53834902,1456555.22064217),    r2: vec3(-7070923.14827495,0.0,-9695465.21994635),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: false, expected_v1: vec3(916.605136319458,-1451.18180853077,268.300341330302), expected_v2: vec3(-82.2365714437413,254.174012591826,60.3791321798631) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-6682950.07258305,0.0,-9966853.98344744),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1610.75095657108,-645.786622819061,-65.115850993885), expected_v2: vec3(-201.170862461562,114.69394466971,138.189527405109) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-7403560.39135532,0.0,-9443902.45245866),              dt: 29319.1011125426, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1622.27593958365,601.69213267423,141.003561150483), expected_v2: vec3(196.758676491832,-107.209349044357,-142.858360757224) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-7216800.3922934,0.0,-9587376.70574145),               dt: 29753.2293685523, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1618.18441414985,-615.022134809576,-131.783888711582), expected_v2: vec3(-204.703004656393,108.78770970914,131.619200242318) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-8739141.50845199,0.0,-8223588.37097598),              dt: 25981.1016266962, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1644.36095780339,512.664608846041,219.002117813152), expected_v2: vec3(127.337960513471,-97.0286797749709,-214.480882792912) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-10051335.8952795,0.0,-6555199.9756122),               dt: 22063.3393127814, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1570.1321505505,-491.715419492736,-573.3425725369), expected_v2: vec3(-283.605270479101,80.4560185956911,76.4021652793502) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-8798847.6564052,0.0,-8159674.00815576),               dt: 25819.8764527134, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1612.83018622351,-538.114523799704,-353.364951574713), expected_v2: vec3(-229.922993796244,92.7319419644979,105.418807823685) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-7656981.25694084,0.0,-9239623.26238774),              dt: 28719.0710428186, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1627.14287848702,584.327750697449,155.660845794765), expected_v2: vec3(186.359602062493,-105.089961629318,-156.240348367185) ),
    (r1: vec3(1120606.68199002,1531932.18885859,630356.901523293),    r2: vec3(-8955445.01911569,0.0,-7987490.50137751),              dt: 27110.7192007318, mu: 3531600000000.0, shortway: false, expected_v1: vec3(408.800982087812,-1522.00110815669,731.350885689704), expected_v2: vec3(-23.9616870228215,260.380136343485,-84.1119469617152) ),
    (r1: vec3(16927.386605324,1049365.79577693,1702461.67955815),     r2: vec3(-10902453.4939867,0.0,-5013632.19746486),              dt: 19285.2887546475, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1331.73029494348,-853.178563133935,-765.430914903688), expected_v2: vec3(-353.989776963976,129.504272123142,46.3567211346465) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-11764034.8617695,0.0,-2368012.62054741),              dt: 13674.0333304648, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1346.43965674714,-478.76697064467,-1137.06060168356), expected_v2: vec3(-622.07425368643,56.781499391875,41.7796513674705) ),
    (r1: vec3(1350110.47011008,1469044.67558395,138134.794469532),    r2: vec3(-11923716.7173752,0.0,-1350918.07441759),              dt: 13908.2347972356, mu: 3531600000000.0, shortway: false, expected_v1: vec3(266.06988748988,-1824.34670252095,48.5595117918603), expected_v2: vec3(-629.016999555465,239.349709774287,-73.6815248726806) ),
    (r1: vec3(1329171.39118578,1481706.11921861,194465.387267232),    r2: vec3(-11439305.7826857,0.0,-3625228.71143508),              dt: 18155.111627551,  mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-982.23411729226,1379.31167168873,-522.371220233068), expected_v2: vec3(-332.735684934005,-287.493312803323,-61.4488875626915) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-11910518.8648148,0.0,-1462716.7774014),               dt: 11983.1513754167, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1795.23145998909,224.677569864162,428.299698023814), expected_v2: vec3(-625.781931569044,-90.2852842671438,-337.555713796286) ),
    (r1: vec3(1444693.29309909,797259.719120726,-1130192.38171162),   r2: vec3(-11840726.1685137,0.0,1948641.52739135),               dt: 8911.99659600298, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1864.0603843089,828.869492883132,-621.05048288493), expected_v2: vec3(-1163.98941769104,-226.641712463294,445.257525123121) ),
    (r1: vec3(506445.548248104,1356143.17340118,1379944.28076915),    r2: vec3(-10796720.6904398,0.0,-5237444.25580157),              dt: 20241.7725093342, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1369.64927194648,1070.406467806,230.870104047881), expected_v2: vec3(-137.20545871039,-222.247399866996,-252.444129623689) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-10787064.883639,0.0,-5257302.65403879),               dt: 19311.4471085759, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1516.58204996976,-472.49746994978,-742.67734447828), expected_v2: vec3(-351.204811917104,72.5130237523222,56.2435296509754) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-10328757.2950448,0.0,-6108745.59464213),              dt: 21094.3531455522, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1666.67220073443,405.912256517875,316.074441382107), expected_v2: vec3(-31.1947738188188,-88.1254736820771,-301.075581589362) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-8872391.21221515,0.0,-8079645.67152591),              dt: 25619.5261815861, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1611.44746072827,-535.025164999064,-364.859241810211), expected_v2: vec3(-231.928060001525,92.0167034984678,103.928318191366) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-10186773.1149025,0.0,-6342685.03912186),              dt: 21598.8029901732, mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1664.26615510906,416.102751099617,307.094461976462), expected_v2: vec3(-11.2207605033764,-88.7524036911432,-293.511720598239) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-8716344.14878601,0.0,-8247747.85501617),              dt: 26042.3326548493, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1614.24477822778,-541.63098534032,-340.628956793273), expected_v2: vec3(-227.792195536933,93.535823087455,107.060085179971) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-10233181.8644221,0.0,-6267534.51762834),              dt: 21435.989131807,  mu: 3531600000000.0, shortway: true,  expected_v1: vec3(-1665.02955909322,412.798948888038,310.020731012571), expected_v2: vec3(-17.5665316563059,-88.542918073004,-295.994102652781) ),
    (r1: vec3(1286751.91214323,1501592.61762113,299074.575330467),    r2: vec3(-8101595.17569511,0.0,-8852353.11141358),              dt: 29632.1908855211, mu: 3531600000000.0, shortway: false, expected_v1: vec3(139.63762182672,-1316.09928927223,1122.75675454697), expected_v2: vec3(74.0409091047509,234.913255704024,-92.2671461657655) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-6682950.07258305,0.0,-9966853.98344744),              dt: 30960.7290321349, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1610.75095657108,-645.786622819061,-65.115850993885), expected_v2: vec3(-201.170862461562,114.69394466971,138.189527405109) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-8277845.02624831,0.0,-8687766.2101035),               dt: 27187.55399418,   mu: 3531600000000.0, shortway: false, expected_v1: vec3(1619.48770322966,-561.217398994122,-275.481158584765), expected_v2: vec3(-218.311584966441,97.8489014335553,115.25009685677) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-9270828.73275908,0.0,-7619168.89219871),              dt: 24496.9488820916, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1601.81520114099,-519.039535206645,-429.707399073626), expected_v2: vec3(-244.771841525849,88.1515813224698,95.39472037694) ),
    (r1: vec3(-446528.573476018,654884.655513795,1836181.06825891),   r2: vec3(-9583342.34859875,0.0,-7222156.84055351),              dt: 23565.5232577865, mu: 3531600000000.0, shortway: false, expected_v1: vec3(1591.42455778144,-507.423547935985,-484.142051968074), expected_v2: vec3(-257.705658574346,85.1081366627953,88.149798795093) )
]

test sync fn test_testsets() -> Unit = {
    const testsets = create_testset()

    assert_int(102, testsets.length)

    for(testset in testsets) {
        const (r1, r2, dt, mu, shortway, expected_v1, expected_v2) = testset
        const (v1, v2, _) = solve_lambert(r1, r2, dt, mu, shortway)
 
        assert_vec3(expected_v1, v1, 1e-5)
        assert_vec3(expected_v2, v2, 1e-5)
    }
}